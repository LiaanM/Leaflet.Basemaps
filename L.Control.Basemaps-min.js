L.Control.Basemaps=L.Control.extend({_map:null,includes:L.Evented?L.Evented.prototype:L.Mixin.Event,options:{position:"bottomright",tileX:0,tileY:0,tileZ:0,layers:[]},basemap:null,onAdd:function(t){this._map=t,this.mapId=t._container.id;var e=L.DomUtil.create("div","basemaps leaflet-control closed");return L.DomEvent.disableClickPropagation(e),L.Browser.touch||L.DomEvent.disableScrollPropagation(e),this.options.basemaps.forEach(function(a,s){var o="basemap";0===s?(this.basemap=a,this._map.addLayer(a),o+=" active"):1===s&&(o+=" alt");var i={x:this.options.tileX,y:this.options.tileY},n=L.Util.template(a._url,L.extend({s:a._getSubdomain(i),x:i.x,y:a.options.tms?a._globalTileRange.max.y-i.y:i.y,z:this.options.tileZ},a.options));if(a instanceof L.TileLayer.WMS){a._map=t;var l=a.options.crs||t.options.crs,m=L.extend({},a.wmsParams),r=parseFloat(m.version),p=r>=1.3?"crs":"srs";m[p]=l.code;var c=L.point(i);c.z=this.options.tileZ;var d=a._tileCoordsToBounds(c),h=l.project(d.getNorthWest()),v=l.project(d.getSouthEast()),b=(r>=1.3&&l===L.CRS.EPSG4326?[v.y,h.x,h.y,v.x]:[h.x,v.y,v.x,h.y]).join(",");n+=L.Util.getParamString(m,n,a.options.uppercase)+(a.options.uppercase?"&BBOX=":"&bbox=")+b}var u=L.DomUtil.create("div",o,e),y=L.DomUtil.create("img",null,u);y.src=n,a.options&&a.options.label&&(y.title=a.options.label),L.DomEvent.on(u,"click",function(){if(a!=this.basemap){t.removeLayer(this.basemap),t.addLayer(a),a.bringToBack(),t.fire("baselayerchange",a),this.basemap=a,this.mapId?L.DomUtil.removeClass(document.getElementById(this.mapId).getElementsByClassName("basemap active")[0],"active"):L.DomUtil.removeClass(document.getElementsByClassName("basemap active")[0],"active"),L.DomUtil.addClass(u,"active");var e=(s+1)%this.options.basemaps.length;this.mapId?(L.DomUtil.removeClass(document.getElementById(this.mapId).getElementsByClassName("basemap alt")[0],"alt"),L.DomUtil.addClass(document.getElementById(this.mapId).getElementsByClassName("basemap")[e],"alt")):(L.DomUtil.removeClass(document.getElementsByClassName("basemap alt")[0],"alt"),L.DomUtil.addClass(document.getElementsByClassName("basemap")[e],"alt"))}},this)},this),this.options.basemaps.length>2&&(L.DomEvent.on(e,"mouseenter",function(){L.DomUtil.removeClass(e,"closed")},this),L.DomEvent.on(e,"mouseleave",function(){L.DomUtil.addClass(e,"closed")},this)),this._container=e,this._container}}),L.control.basemaps=function(t){return new L.Control.Basemaps(t)};